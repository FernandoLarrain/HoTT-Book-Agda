{-# OPTIONS --without-K --exact-split #-}

module Ch3.2-Propositions-as-types where

open import Ch1.Type-theory
open import Ch2.Homotopy-type-theory


-- Theorem 3.2.2 (DNE is incompatible with univalence).

-- (i) Some auxiliary lemmas:
  
dne-ğŸš-is-prop : (u v : Â¬ (Â¬ ğŸš)) â†’ u â‰¡ v
dne-ğŸš-is-prop u v = funext _ _ (Î» x â†’ !ğŸ˜ _ (u x))

ğŸš-is-nonempty : Â¬ (is-empty ğŸš)
ğŸš-is-nonempty x = x â‚€
  
-- (ii) The theorem:
  
not-dne : Â¬ ((A : ğ“¤â‚€ Ì‡ ) â†’ Â¬ (Â¬ A) â†’ A)
not-dne f = e-has-no-fixed-pt (f ğŸš ğŸš-is-nonempty) (e-has-fixed-pt ğŸš-is-nonempty)

  where
  
  -- (a) Define automorphism of ğŸš with no fixed point

  e : ğŸš â†’ ğŸš
  e â‚€ = â‚
  e â‚ = â‚€
  
  e' : ğŸš â‰ƒ ğŸš
  e' =
    e ,
    qinv-to-isequiv (e ,
      ğŸš-induction (Î» - â†’ e (e -) â‰¡ -) (refl _) (refl _) ,
      ğŸš-induction (Î» - â†’ e (e -) â‰¡ -) (refl _) (refl _))

  e-has-no-fixed-pt : (x : ğŸš) â†’ Â¬ (e x â‰¡ x)
  e-has-no-fixed-pt â‚€ c = â‚€-is-not-â‚ (c â»Â¹)
  e-has-no-fixed-pt â‚ c = â‚€-is-not-â‚ c

  -- (b) Show that, by univalence, the automorphism must have a fixed point
  
  p : ğŸš â‰¡ ğŸš 
  p = ua ğŸš ğŸš e'
    
  e-has-fixed-pt : (u : Â¬ (Â¬ ğŸš)) â†’ e (f ğŸš u) â‰¡ f ğŸš u
  e-has-fixed-pt u =
    e (f ğŸš u)
      â‰¡âŸ¨ (idtoeqv-Î² ğŸš ğŸš e' (f ğŸš u)) â»Â¹ âŸ©
    prâ‚ (idtoeqv ğŸš ğŸš p) (f ğŸš u)
      â‰¡âŸ¨ ap (Î» - â†’ prâ‚ (idtoeqv ğŸš ğŸš p) (f ğŸš -)) (dne-ğŸš-is-prop _ _) âŸ©
    prâ‚ (idtoeqv ğŸš ğŸš p) (f ğŸš (transport (Î» - â†’ Â¬ (Â¬ - )) (p â»Â¹) u))
      â‰¡âŸ¨ refl _ âŸ©
    transport (Î» - â†’ -) p (f ğŸš (transport (Î» - â†’ Â¬ (Â¬ - )) (p â»Â¹) u))
      â‰¡âŸ¨ (transport-fun' ğŸš ğŸš p (f ğŸš) u) â»Â¹ âŸ©
    transport (Î» - â†’ (Â¬ (Â¬ -) â†’ -)) p (f ğŸš) u
      â‰¡âŸ¨ happly _ _ (apd f p) u âŸ© 
    f ğŸš u âˆ


-- Corollary 3.2.7 (LEM is incompatible with univalence).

not-lem : Â¬ ((A : ğ“¤â‚€ Ì‡ ) â†’ A + (Â¬ A))
not-lem g = not-dne (Î» A â†’ +-recursion (Î» a f â†’ a) (Î» w f â†’ !ğŸ˜ _ (f w)) (g A))


-- Remark 3.2.6 ("Triple negation law" is compatible with univalence).

tnl : (A : ğ“¤ Ì‡ ) â†’ Â¬ (Â¬ (Â¬ A)) â†’ Â¬ A
tnl A f = Î» a â†’ f (Î» g â†’ g a)

