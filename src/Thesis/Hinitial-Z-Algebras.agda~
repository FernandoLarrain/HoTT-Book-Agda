{-# OPTIONS --without-K --exact-split --safe #-}

open import Ch1.Type-theory
open import Ch2.Homotopy-type-theory
open import Ch3.Sets-and-logic
open import Ch4.Equivalences
open import Thesis.Z-Algebras
open import Thesis.Identity-types

module Thesis.Hinitial-Z-Algebras where


-- V. Identity Type of Algebras

isiso : (A : Alg ğ“¤) (B : Alg ğ“¥) â†’ Hom A B â†’ ğ“¤ âŠ” ğ“¥ Ì‡
isiso A B f = Î£ g ê‰ Hom B A , (comp B A B f g â‰¡ algid B) Ã— (comp A B A g f â‰¡ algid A)

_â‰…_ : Alg ğ“¤ â†’ Alg ğ“¥ â†’ ğ“¤ âŠ” ğ“¥ Ì‡
A â‰… B = Î£ f ê‰ Hom A B , isiso A B f

isiso-to-isequiv : â¦ƒ fe : FunExt â¦„ (A : Alg ğ“¤) (B : Alg ğ“¥) (f : Hom A B) â†’ isiso A B f â†’ isequiv (prâ‚ f)
isiso-to-isequiv A B f (g , qfg , qgf) = qinv-to-isequiv (prâ‚ g , prâ‚ (Hom-â‰¡-elim B B _ _ qfg) , prâ‚ (Hom-â‰¡-elim A A _ _ qgf))

AlgId : Alg ğ“¤ â†’ Alg ğ“¥ â†’ ğ“¤ âŠ” ğ“¥ Ì‡
AlgId (A , Str-A) (B , Str-B) = Î£ e ê‰ A â‰ƒ B , HomStr (A , Str-A) (B , Str-B) (prâ‚ e)

module _ (univ : Univalence) where

  open Full-Univalence univ

  IdAlg-â‰ƒ-AlgId : (A B : Alg ğ“¤) â†’ (A â‰¡ B) â‰ƒ (AlgId A B)
  IdAlg-â‰ƒ-AlgId {ğ“¤} (A , aâ‚€ , s , i) (B , bâ‚€ , s' , j) = Î£-â‰¡-â‰ƒ â— Î£-preserves-â‰ƒ _ _ (idtoeqv , idtoeqv-is-equiv {ğ“¤}) (aux-equiv A' B') where
    A' = (A , aâ‚€ , s , i)
    B' = (B , bâ‚€ , s' , j)
    aux-equiv : (A B : Alg ğ“¤) (p : prâ‚ A â‰¡ prâ‚ B) â†’ (transport AlgStr p (prâ‚‚ A) â‰¡ prâ‚‚ B) â‰ƒ HomStr A B (coe p)
    aux-equiv (A , aâ‚€ , s , i) (.A , bâ‚€ , s' , j) (refl .A) = ((aâ‚€ , s , i) â‰¡ (bâ‚€ , s' , j)) â‰ƒâŸ¨ Ã—-â‰¡-â‰ƒ â— Ã—-preserves-â‰ƒ (â‰ƒ-refl _) (Î£-over-predicate' (ishae-is-Prop) _ _ â— happly , happly-is-equiv {ğ“¤}) âŸ© ((aâ‚€ â‰¡ bâ‚€) Ã— (s âˆ¼ s')) â–   

  â‰…-to-â‰¡ : (A B : Alg ğ“¤) â†’ A â‰… B â†’ A â‰¡ B
  â‰…-to-â‰¡ A B ((f , Str-f) , i) = inv (IdAlg-â‰ƒ-AlgId A B) ((f , isiso-to-isequiv A B (f , Str-f) i) , Str-f)

  â‰¡-to-â‰… : (A B : Alg ğ“¤) â†’ A â‰¡ B â†’ A â‰… B
  â‰¡-to-â‰… A .A (refl .A) = (id , refl _ , hrefl _) , ((id , refl _ , hrefl _) , ((refl _) , (refl _)))


-- VI. Initial Algebras

ishinit : (ğ“¥ : Universe) â†’ Alg ğ“¤ â†’ ğ“¤ âŠ” ğ“¥ âº Ì‡
ishinit ğ“¥ A = (B : Alg ğ“¥) â†’ isContr (Hom A B)

ishinit-is-Prop : â¦ƒ fe : FunExt â¦„ (ğ“¥ : Universe) (A : Alg ğ“¤) â†’ isProp (ishinit ğ“¥ A)
ishinit-is-Prop ğ“¥ A = Î -preserves-Props _ (Î» B â†’ isContr-is-Prop _)

hasrec : (ğ“¥ : Universe) â†’ Alg ğ“¤ â†’ ğ“¤ âŠ” ğ“¥ âº Ì‡
hasrec ğ“¥ A = (B : Alg ğ“¥) â†’ Hom A B

hasrecunique : (ğ“¥ : Universe) (A : Alg ğ“¤) â†’ ğ“¤ âŠ” ğ“¥ âº Ì‡
hasrecunique ğ“¥ A = (B : Alg ğ“¥) â†’ isProp (Hom A B)

ishinit-is-rec&unique : â¦ƒ fe : FunExt â¦„ (ğ“¥ : Universe) (A : Alg ğ“¤) â†’ ishinit ğ“¥ A â‰ƒ (hasrec ğ“¥ A Ã— hasrecunique ğ“¥ A) 
ishinit-is-rec&unique {ğ“¤} ğ“¥ A = â‡”-to-â‰ƒ (ishinit-is-Prop ğ“¥ A) rec&unique-is-Prop (ishinit-to-rec&unique , rec&unique-to-ishinit)
  where
  rec&unique-is-Prop : isProp (hasrec ğ“¥ A Ã— hasrecunique ğ“¥ A)
  rec&unique-is-Prop (rec , Î·) (rec' , Î·') = inv Ã—-â‰¡-â‰ƒ ((funext (Î» B â†’ Î· B _ _)) , Î -preserves-Props _ (Î» B â†’ isProp-is-Prop _) _ _)
  ishinit-to-rec&unique : ishinit ğ“¥ A â†’ hasrec ğ“¥ A Ã— hasrecunique ğ“¥ A
  ishinit-to-rec&unique A-init = (Î» B â†’ prâ‚ (A-init B)) , (Î» B â†’ isContr-to-isProp (A-init B))
  rec&unique-to-ishinit : hasrec ğ“¥ A Ã— hasrecunique ğ“¥ A â†’ ishinit ğ“¥ A
  rec&unique-to-ishinit (rec , Î·) B = (rec B) , (Î· B (rec B))

rec&unique-to-ishinit : â¦ƒ fe : FunExt â¦„ (ğ“¥ : Universe) (A : Alg ğ“¤) â†’ hasrec ğ“¥ A Ã— hasrecunique ğ“¥ A â†’ ishinit ğ“¥ A
rec&unique-to-ishinit ğ“¥ A = inv (ishinit-is-rec&unique ğ“¥ A) 

InitAlg : (ğ“¤ : Universe) â†’ ğ“¤ âº Ì‡
InitAlg ğ“¤ = Î£ A ê‰ Alg ğ“¤ , ishinit ğ“¤ A

abstract

  InitAlg-is-Prop : (univ : Univalence) (ğ“¤ : Universe) â†’ isProp (InitAlg ğ“¤)
  InitAlg-is-Prop univ ğ“¤ (A , A-init) (B , B-init)  = Î£-over-predicate (ishinit-is-Prop ğ“¤) (â‰…-to-â‰¡ univ A B (
    prâ‚ (A-init B) ,
    prâ‚ (B-init A) ,
    isContr-to-isProp (B-init B) _ _ ,
    isContr-to-isProp (A-init A) _ _
    ))
    where open Full-Univalence univ

â‰…-is-Contr : (A B : InitAlg ğ“¤) â†’ isContr (prâ‚ A â‰… prâ‚ B)
â‰…-is-Contr (A , A-init) (B , B-init) = â‰ƒ-preserves-Contr (â‰ƒ-sym (Î£-over-Contr-base-is-fib (Hom A B) (isiso A B) (A-init B) â— Î£-over-Contr-base-is-fib (Hom B A) _ (B-init A))) (Ã—-preserves-Contr _ _ (prâ‚ Prop-iff-Contr-â‰¡ (prâ‚‚ (prâ‚ isContr-iff-is-inhabited-Prop (B-init B))) _ _) (prâ‚ Prop-iff-Contr-â‰¡ (prâ‚‚ (prâ‚ isContr-iff-is-inhabited-Prop (A-init A))) _ _))
