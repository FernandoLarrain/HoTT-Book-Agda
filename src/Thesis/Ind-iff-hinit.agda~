{-# OPTIONS --without-K --exact-split --safe #-}

open import Ch1.Type-theory
open import Ch2.Homotopy-type-theory
open import Ch3.Sets-and-logic
open import Ch4.Equivalences
open import Thesis.Z-Algebras
open import Thesis.Identity-types
open import Thesis.Hinitial-Z-Algebras
open import Thesis.Inductive-Z-Algebras

module Thesis.Ind-iff-hinit where


-- I. Every Inductive Algebra is Homotopy-Initial

isind-to-hasrec : (A : Alg ğ“¤) â†’ isind ğ“¤ A â†’ hasrec ğ“¤ A
isind-to-hasrec A A-ind B = A-ind (ConstFibAlg A B)

isind-to-hasrecunique : â¦ƒ fe : FunExt â¦„ (A : Alg ğ“¤) â†’ isind ğ“¤ A â†’ hasrecunique ğ“¤ A
isind-to-hasrecunique {ğ“¤} A A-ind B = uniqueness-pple A A-ind (ConstFibAlg A B)

isind-to-ishinit : â¦ƒ fe : FunExt â¦„ (A : Alg ğ“¤) â†’ isind ğ“¤ A â†’ ishinit ğ“¤ A
isind-to-ishinit A A-ind B = prâ‚‚ isContr-iff-is-inhabited-Prop (isind-to-hasrec A A-ind B , isind-to-hasrecunique A A-ind B)


-- II. Every Initial Algebra is Inductive

ishinit-to-isind : â¦ƒ fe : FunExt â¦„ (A : Alg ğ“¤) â†’ ishinit ğ“¤ A â†’ isind ğ“¤ A
ishinit-to-isind {ğ“¤} (A , aâ‚€ , s , i) init (E , eâ‚€ , s' , j) = g , gâ‚€ , g-s

  where

  -- 1. Useful names

  A' : Alg ğ“¤
  A' = (A , aâ‚€ , s , i)

  E' : FibAlg ğ“¤ A'
  E' = (E , eâ‚€ , s' , j)

  T : Alg ğ“¤
  T = TotAlg A' E'

  -- 2. Initiality gives morphism f into T

  A-rec : Hom A' T
  A-rec = prâ‚ (init T)

  f : A â†’ Î£ E
  f = prâ‚ A-rec

  fâ‚€ : f aâ‚€ â‰¡ (aâ‚€ , eâ‚€)
  fâ‚€ = prâ‚ (prâ‚‚ A-rec)

  f-s : f âˆ˜ s âˆ¼ totalâ†“ E s s' âˆ˜ f
  f-s = prâ‚‚ (prâ‚‚ A-rec)

  -- 2.1 First components of f

  fâ‚ : A â†’ A
  fâ‚ = prâ‚ âˆ˜ f

  fâ‚€â‚ : fâ‚ aâ‚€ â‰¡ aâ‚€
  fâ‚€â‚ = prâ‚ (dpr-â‰¡ fâ‚€)

  f-sâ‚ : fâ‚ âˆ˜ s âˆ¼ s âˆ˜ fâ‚
  f-sâ‚ a = prâ‚ (dpr-â‰¡ (f-s a))

  -- 2.2 Second components of f

  fâ‚‚ : (a : A) â†’ E (fâ‚ a)
  fâ‚‚ = prâ‚‚ âˆ˜ f

  fâ‚€â‚‚ : transport E fâ‚€â‚ (fâ‚‚ aâ‚€) â‰¡ eâ‚€
  fâ‚€â‚‚ = prâ‚‚ (dpr-â‰¡ fâ‚€)

  f-sâ‚‚ : (a : A) â†’ transport E (f-sâ‚ a) (fâ‚‚ (s a)) â‰¡ s' (fâ‚ a) (fâ‚‚ a)
  f-sâ‚‚ a = prâ‚‚ (dpr-â‰¡ (f-s a))


  -- 4. Initiality gives path from Ï€â‚âˆ˜f to algid A'

  A-uniqueness : isProp (Hom A' A')
  A-uniqueness = prâ‚‚ (prâ‚ isContr-iff-is-inhabited-Prop (init A'))    

  path : Id (Hom A' A') (fâ‚ , fâ‚€â‚ , f-sâ‚) (algid A')
  path = A-uniqueness _ _

  -- 4.1 Extension of path

  pathext : HomId A' A' (fâ‚ , fâ‚€â‚ , f-sâ‚) (algid A')
  pathext = Hom-â‰¡-elim A' A' _ _ path

  H : fâ‚ âˆ¼ id
  H = prâ‚ pathext

  Hâ‚€ : H aâ‚€ â‰¡ fâ‚€â‚
  Hâ‚€ = prâ‚ (prâ‚‚ pathext) âˆ™ ru _ â»Â¹  

  H-s : (a : A) â†’ H (s a) â‰¡ f-sâ‚ a âˆ™ ap s (H a)
  H-s a = prâ‚‚ (prâ‚‚ pathext) a âˆ™ ru _ â»Â¹

  -- 5. Construction of section

  g : (a : A) â†’ E a
  g a = transport E (H a) (fâ‚‚ a)

  gâ‚€ : g aâ‚€ â‰¡ eâ‚€
  gâ‚€ = transport E (H aâ‚€) (fâ‚‚ aâ‚€)
           â‰¡âŸ¨ ap (Î» - â†’ transport E - (fâ‚‚ aâ‚€)) Hâ‚€ âŸ©
         transport E fâ‚€â‚ (fâ‚‚ aâ‚€)
           â‰¡âŸ¨ fâ‚€â‚‚ âŸ©
         eâ‚€ âˆ

  g-s : (a : A) â†’ g (s a) â‰¡ s' a (g a)
  g-s a = transport E (H (s a)) (fâ‚‚ (s a))
            â‰¡âŸ¨ ap (Î» - â†’ transport E - (fâ‚‚ (s a))) (H-s a) âŸ©
          transport E (f-sâ‚ a âˆ™ ap s (H a)) (fâ‚‚ (s a))
            â‰¡âŸ¨ transport-âˆ™ E (f-sâ‚ a) (ap s (H a)) (fâ‚‚ (s a)) â»Â¹ âŸ©
          transport E (ap s (H a)) (transport E (f-sâ‚ a) (fâ‚‚ (s a)))
            â‰¡âŸ¨ ap (transport E (ap s (H a))) (f-sâ‚‚ a) âŸ©
          transport E (ap s (H a)) (s' (fâ‚ a) (fâ‚‚ a))
            â‰¡âŸ¨ â„ (fâ‚ a) (Î» b p â†’ transport E (ap s p) (s' (fâ‚ a) (fâ‚‚ a)) â‰¡ s' b (transport E p (fâ‚‚ a))) (refl _) a (H a) âŸ©
          s' a (transport E (H a) (fâ‚‚ a)) âˆ


-- III. The Equivalence

isind-iff-ishinit : â¦ƒ fe : FunExt â¦„ (A : Alg ğ“¤) â†’ isind ğ“¤ A â‡” ishinit ğ“¤ A
isind-iff-ishinit A = (isind-to-ishinit A) , (ishinit-to-isind A)

isind-â‰ƒ-ishinit : â¦ƒ fe : FunExt â¦„ (A : Alg ğ“¤) â†’ isind ğ“¤ A â‰ƒ ishinit ğ“¤ A
isind-â‰ƒ-ishinit {ğ“¤} A = â‡”-to-â‰ƒ (isind-is-Prop A) (ishinit-is-Prop ğ“¤ A) (isind-iff-ishinit A)
