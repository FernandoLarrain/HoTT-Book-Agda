{-# OPTIONS --without-K --exact-split #-}

open import Ch1.Type-theory
open import Ch2.Homotopy-type-theory
open import Ch3.Sets-and-logic
open import Ch4.Equivalences

module Ch5.8-Id-types-and-id-systems where


-- Definition 5.8.1 (Pointed predicate, pointed family of maps, identity system)

pted-pred : (A : ğ“¤ âŠ™) â†’ ğ“¤ âº Ì‡
pted-pred {ğ“¤} (A , aâ‚€) = Î£ R ê‰ (A â†’ ğ“¤ Ì‡) , R aâ‚€

ppmap : (A : ğ“¤ âŠ™) â†’ pted-pred A â†’ pted-pred A â†’ ğ“¤ Ì‡
ppmap (A , aâ‚€) (R , râ‚€) (S , sâ‚€) = Î£ g ê‰ Î  (Î» a â†’ R a â†’ S a) , g aâ‚€ râ‚€ â‰¡ sâ‚€ 

is-id-system : {A : ğ“¤ âŠ™} â†’ pted-pred A â†’ ğ“¤ âº Ì‡
is-id-system {ğ“¤} {A , aâ‚€} (R , râ‚€) = (D : (a : A) â†’ R a â†’ ğ“¤ Ì‡) (d : D aâ‚€ râ‚€) â†’ Î£ f ê‰ ((a : A) (r : R a) â†’ D a r) , f aâ‚€ râ‚€ â‰¡ d

id-system : (A : ğ“¤ âŠ™) â†’ ğ“¤ âº Ì‡
id-system {ğ“¤} (A , aâ‚€) = Î£ R ê‰ pted-pred (A , aâ‚€) , is-id-system R


-- Theorem 5.8.2

module thm582 (A' : ğ“¤ âŠ™) (R' : pted-pred A') where

  -- Unfold the pointed type and predicate

  A = prâ‚ A'
  aâ‚€ = prâ‚‚ A'
  R = prâ‚ R'
  râ‚€ = prâ‚‚ R'

  -- TFAE

  i = is-id-system R'
  ii = (S' : pted-pred A') â†’ isContr (ppmap A' R' S')
  iii = (a : A) â†’ isequiv (Î» (- : aâ‚€ â‰¡ a) â†’ transport R - râ‚€)
  iv = isContr (Î£ R)

  -- The statements are propositions (the proof of i-is-Prop is omitted).

  ii-is-Prop : isProp ii
  ii-is-Prop = Î -preserves-Props _ (Î» S' â†’ isContr-is-Prop _)

  iii-is-Prop : isProp iii
  iii-is-Prop = Î -preserves-Props _ (Î» a â†’ ishae-is-Prop _)

  iv-is-Prop : isProp iv
  iv-is-Prop = isContr-is-Prop _

  -- Proof of the logical equivalences

  aux : (X : ğ“¤ Ì‡) (Y Z : X â†’ ğ“¥ Ì‡) (f g : (x : X) â†’ Y x â†’ Z x) (p : f â‰¡ g) (x : X) (y : Y x) (z : Z x) (q : f x y â‰¡ z) â†’ transport (Î» - â†’ - x y â‰¡ z) p q â‰¡ (happly (f x) (g x) (happly f g p x) y) â»Â¹ âˆ™ q
  aux X Y Z f .f (refl .f) x y .(f x y) (refl .(f x y)) = refl _

  -- Maybe we can just use transport in fibers...

  i-to-ii : i â†’ ii
  i-to-ii R'-is-id-system (S , sâ‚€) = prâ‚‚ (isContr-iff-is-inhabited-Prop _) (
    (R'-is-id-system (Î» a r â†’ S a) sâ‚€) ,
    Î£-induction (Î» f fr â†’ Î£-induction Î» g gr â†’ dpair-â‰¡ (
      (funext _ _ Î» a â†’ funext _ _ Î» r â†’ prâ‚ (R'-is-id-system (Î» a r â†’ f a r â‰¡ g a r) (fr âˆ™ gr â»Â¹)) a r) ,
      (aux _ _ _ f g (funext _ _ Î» a â†’ funext _ _ Î» r â†’ prâ‚ (R'-is-id-system (Î» a r â†’ f a r â‰¡ g a r) (fr âˆ™ gr â»Â¹)) a r) aâ‚€ râ‚€ sâ‚€ fr âˆ™ (ap (Î» - â†’ happly (f aâ‚€) (g aâ‚€) - râ‚€ â»Â¹ âˆ™ fr) (happly-Î² _ _ _ aâ‚€) âˆ™ (ap (Î» - â†’ - â»Â¹ âˆ™ fr) (happly-Î² _ _ _ râ‚€ âˆ™ prâ‚‚ (R'-is-id-system (Î» a r â†’ f a r â‰¡ g a r) (fr âˆ™ gr â»Â¹))) âˆ™ ((distr fr (gr â»Â¹) âˆ™áµ£ fr) âˆ™ âˆ™-assoc _ _ _ â»Â¹ âˆ™ ap ((gr â»Â¹) â»Â¹ âˆ™_) (linv _) âˆ™ ru _ â»Â¹ âˆ™ â»Â¹-invol _ ))))
      ))
    )

  ii-to-iii : ii â†’ iii
  ii-to-iii ppmap-is-Contr a = {!!}
  
  iii-to-iv : iii â†’ iv
  iii-to-iv = {!!}

  iv-to-i : iv â†’ i
  iv-to-i = {!!}
  
  
