{-# OPTIONS --without-K --exact-split --safe #-}

open import Ch1.Type-theory
open import Ch2.Homotopy-type-theory
open import Ch3.Sets-and-logic
open import Ch4.Equivalences

module Ch5.Exercises where


-- Exercise: characterization of Î -types (a dependent function is a section of the projection of total space).

module _ â¦ƒ fe : FunExt â¦„ {A : ğ“¤ Ì‡} {B : ğ“¥ Ì‡} (f : A â†’ B) {g h : has-section f} where

  has-section-â‰¡ : (g â‰¡ h) â‰ƒ (Î£ Î± ê‰ prâ‚ g âˆ¼ prâ‚ h , ((y : B) â†’ ap f (Î± y) â»Â¹ âˆ™ prâ‚‚ g y â‰¡ prâ‚‚ h y)) 
  has-section-â‰¡ = Î£-â‰¡-â‰ƒ â— Î£-preserves-â‰ƒ _ _ (happly , happly-is-equiv) Î» p â†’ (happly , happly-is-equiv) â— Î -preserves-family-â‰ƒ (Î» y â†’ (transport-lemma â»Â¹ âˆ™_) , (qinv-to-isequiv (qinv-pre-âˆ™ _ _))) where
    transport-lemma : {p : prâ‚ g â‰¡ prâ‚ h} {y : B} â†’  transport (Î» s â†’ f âˆ˜ s âˆ¼ id) p (prâ‚‚ g) y â‰¡ ap f (happly p y) â»Â¹ âˆ™ prâ‚‚ g y
    transport-lemma {refl .(fst g)} = lu _

module _ â¦ƒ fe : FunExt â¦„ (A : ğ“¤ Ì‡) (B : A â†’ ğ“¥ Ì‡) where

  Ï• : Î  B â†’ has-section {_} {_} {Î£ B} prâ‚
  Ï• f = (Î» a â†’ a , (f a)) , (hrefl _)

  Ïˆ : has-section {_} {_} {Î£ B} prâ‚ â†’ Î  B
  Ïˆ (g , s) = Î» a â†’ transport B (s a) (prâ‚‚ (g a))

  Î± : Ï• âˆ˜ Ïˆ âˆ¼ id
  Î± (g , s) = inv (has-section-â‰¡ prâ‚) ((Î» a â†’ dpair-â‰¡ ((s a â»Â¹) , (transport-âˆ™ B (s a) (s a â»Â¹) (prâ‚‚ (g a)) âˆ™ ap (Î» - â†’ transport B - (prâ‚‚ (g a))) (rinv (s a))))) , Î» a â†’ ru _ â»Â¹ âˆ™ (ap _â»Â¹ (dprâ‚-â‰¡-Î² _ _) âˆ™ â»Â¹-invol _))

  Î² : Ïˆ âˆ˜ Ï• âˆ¼ id
  Î² f = refl _

  dfuns-are-sections-of-prâ‚ : Î  B â‰ƒ has-section {_} {_} {Î£ B} prâ‚ 
  dfuns-are-sections-of-prâ‚ = Ï• , (qinv-to-isequiv (Ïˆ , (Î± , Î²)))
