{-# OPTIONS --without-K --exact-split #-}

open import Ch1.Type-theory
open import Ch2.1-Types-are-higher-groupoids
open import Ch2.2-Functions-are-functors
open import Ch2.3-Type-families-are-fibrations 
open import Ch2.4-Homotopies-and-equivalences
open import Ch2.7-Î£-types
open import Ch2.9-Î -types-and-funext

module Ch2.Exercises where


-- Exercise 2.10 (Dependent pairing is associative).

Î£-assoc : (A : ğ“¤ Ì‡ ) (B : A â†’ ğ“¥ Ì‡ ) (C : Î£ B â†’ ğ“¦ Ì‡ ) â†’ (Î£ (Î» x â†’ Î£ (Î» y â†’ C (x , y)))) â‰ƒ Î£ C
Î£-assoc A B C = f , qinv-to-isequiv (g , (Î± , Î²))
 where
 f : Î£ (Î» x â†’ Î£ (Î» y â†’ C (x , y))) â†’ Î£ C
 f (x , (y , z)) = (x , y) , z
 g : Î£ C â†’ Î£ (Î» x â†’ Î£ (Î» y â†’ C (x , y)))
 g ((x , y) , z) = x , (y , z)
 Î± : (f âˆ˜ g) âˆ¼ id
 Î± ((x , y) , z) = refl _
 Î² : (g âˆ˜ f) âˆ¼ id
 Î² (x , (y , z)) = refl _

-- Related result: swapping independent arguments / components.

Î£-swap : (A : ğ“¤ Ì‡) (B : ğ“¥ Ì‡) (C : A â†’ B â†’ ğ“¦ Ì‡) â†’ (Î£ Î» a â†’ Î£ Î» b â†’ C a b) â‰ƒ (Î£ Î» b â†’ Î£ Î» a â†’ C a b)
Î£-swap A B C =
  (Î£-induction (Î» a â†’ Î£-induction Î» b c â†’ b , a , c)) ,
  (qinv-to-isequiv (
    Î£-induction (Î» b â†’ Î£-induction Î» a c â†’ a , b , c) ,
    refl ,
    refl 
  ))


-- Exercise 2.17 (Type constructors preserve equivalences)

-- (i) Î£ preserves equivalences
  
Î£-preserves-family-â‰ƒ : {A : ğ“¤ Ì‡} {P : A â†’ ğ“¦ Ì‡} {Q : A â†’ ğ“£ Ì‡} â†’ ((a : A) â†’ P a â‰ƒ Q a) â†’ Î£ P â‰ƒ Î£ Q
Î£-preserves-family-â‰ƒ f =
  Î£-induction (Î» a p â†’ a , (prâ‚ (f a) p)) ,
  (qinv-to-isequiv (
    Î£-induction (Î» a q â†’ a , (qinvâ‚ (isequiv-to-qinv (prâ‚‚ (f a))) q)) ,
    Î£-induction (Î» a q â†’ dpair-â‰¡ (refl a , (qinvâ‚‚ (isequiv-to-qinv (prâ‚‚ (f a))) q))) ,
    Î£-induction (Î» a p â†’ dpair-â‰¡ ((refl a) , ((qinvâ‚ƒ (isequiv-to-qinv (prâ‚‚ (f a))) p))))
    )
  )

-- (ii) Î  preserves equivalences

Î -preserves-family-â‰ƒ : {A : ğ“¤ Ì‡} {P : A â†’ ğ“¦ Ì‡} {Q : A â†’ ğ“£ Ì‡} â†’ ((a : A) â†’ P a â‰ƒ Q a) â†’ Î  P â‰ƒ Î  Q
Î -preserves-family-â‰ƒ Ï• =
  (Î» f a â†’ F a (f a)) ,
  (qinv-to-isequiv (
    (Î» g a â†’ G a (g a)) ,
    (Î» g â†’ funext _ _ Î» a â†’ Î± a (g a)) ,
    Î» f â†’ funext _ _ Î» a â†’ Î² a (f a)
    )
  )
  where
  F = (Î» a â†’ prâ‚ (Ï• a))
  q = (Î» a â†’ isequiv-to-qinv (prâ‚‚ (Ï• a)))
  G = (Î» a â†’ qinvâ‚ (q a))
  Î± = (Î» a â†’ qinvâ‚‚ (q a))
  Î² = (Î» a â†’ qinvâ‚ƒ (q a))
    

module whiskering-and-hz-composition where


  -- (i) Whiskering


  -- Alternative definition of whiskering operations

  âˆ™áµ£-agrees-with-ap : {A : ğ“¤ Ì‡ } {a b c : A} {p q : a â‰¡ b} (Î± : p â‰¡ q) (r : b â‰¡ c) â†’ Î± âˆ™áµ£ r â‰¡ ap (_âˆ™ r) Î±
  âˆ™áµ£-agrees-with-ap {ğ“¤} {A} {.b} {.b} {.b} {.(refl b)} {.(refl b)} (refl (refl .b)) (refl b) = refl _

  âˆ™â‚—-agrees-with-ap : {A : ğ“¤ Ì‡ } {a b c : A} {r s : b â‰¡ c} (q : a â‰¡ b) (Î² : r â‰¡ s) â†’ q âˆ™â‚— Î² â‰¡ ap (q âˆ™_) Î² 
  âˆ™â‚—-agrees-with-ap {ğ“¤} {A} {.b} {.b} {.b} {.(refl b)} {.(refl b)} (refl b) (refl (refl .b)) = refl _


  -- Iterated whiskering (particular case of associativity of _â‹†'_)

  iterated-âˆ™áµ£-is-âˆ™ : {A : ğ“¤ Ì‡ } {a b c d : A} {p q : a â‰¡ b} (Î± : p â‰¡ q) (r : b â‰¡ c) (s : c â‰¡ d)  â†’ (Î± âˆ™áµ£ r) âˆ™áµ£ s â‰¡ (âˆ™-assoc _ _ _ â»Â¹) âˆ™ (Î± âˆ™áµ£ (r âˆ™ s)) âˆ™ (âˆ™-assoc _ _ _)
  iterated-âˆ™áµ£-is-âˆ™ (refl (refl .x)) (refl .x) (refl x) = refl _

  iterated-âˆ™â‚—-is-âˆ™ : {A : ğ“¤ Ì‡ } {a b c d : A} {r s : c â‰¡ d} (p : a â‰¡ b) (q : b â‰¡ c) (Î² : r â‰¡ s) â†’ p âˆ™â‚— (q âˆ™â‚— Î²) â‰¡ (âˆ™-assoc _ _ _) âˆ™ ((p âˆ™ q) âˆ™â‚— Î²) âˆ™ (âˆ™-assoc _ _ _ â»Â¹)
  iterated-âˆ™â‚—-is-âˆ™ (refl .x) (refl x) (refl (refl .x)) = refl _


  -- Unit laws for whiskering (particular case of identity of _â‹†'_)

  âˆ™áµ£-ru : {A : ğ“¤ Ì‡} {a b : A} {p q : a â‰¡ b} (Î± : p â‰¡ q) â†’ ru p â»Â¹ âˆ™ Î± âˆ™ ru q  â‰¡ Î± âˆ™áµ£ refl b   
  âˆ™áµ£-ru (refl (refl x)) = refl _

  âˆ™â‚—-lu : {A : ğ“¤ Ì‡} {a b : A} {p q : a â‰¡ b} (Î± : p â‰¡ q) â†’ lu p â»Â¹ âˆ™ Î± âˆ™ lu q â‰¡ refl a âˆ™â‚— Î±   
  âˆ™â‚—-lu (refl (refl x)) = refl _


  -- (ii) Horizontal composition


  -- Associativity of horizontal composition

  â‹†'-assoc : {A : ğ“¤ Ì‡ } {a b c d : A} {p q : a â‰¡ b} {r s : b â‰¡ c} {t u : c â‰¡ d} (Î± : p â‰¡ q) (Î² : r â‰¡ s) (Î³ : t â‰¡ u) â†’ Î± â‹†' (Î² â‹†' Î³) â‰¡ âˆ™-assoc p r t âˆ™ ((Î± â‹†' Î²) â‹†' Î³) âˆ™ (âˆ™-assoc q s u â»Â¹)
  â‹†'-assoc (refl (refl .x)) (refl (refl .x)) (refl (refl x)) = refl _


  -- Unit laws for horizontal composition

  â‹†'-ru : {A : ğ“¤ Ì‡ } {a b c : A} {p q : a â‰¡ b} (Î± : p â‰¡ q) â†’ Î± â‰¡ ru p âˆ™ (Î± â‹†' refl (refl b)) âˆ™ ru q â»Â¹
  â‹†'-ru (refl (refl x)) = refl _


  -- Horizontal inverse

  â‹†'-sym : {A : ğ“¤ Ì‡ } {a b : A} {p q : a â‰¡ b} (Î± : p â‰¡ q) â†’  p â»Â¹ â‰¡ q â»Â¹
  â‹†'-sym {p = refl x} (refl .(refl x)) = refl _


  -- Inverse law

  â‹†'-rinv : {A : ğ“¤ Ì‡ } {a b : A} {p q : a â‰¡ b} (Î± : p â‰¡ q) â†’  Î± â‹†' (â‹†'-sym Î±) â‰¡ rinv p âˆ™ refl (refl a) âˆ™ (rinv q â»Â¹)
  â‹†'-rinv {p = .(refl x)} (refl (refl x)) = refl _


  -- Whiskering is horizontal composition with refl

  â‹†'-refl-is-âˆ™áµ£ : {A : ğ“¤ Ì‡ } {a b c : A} {p q : a â‰¡ b} (Î± : p â‰¡ q) (r : b â‰¡ c) â†’ Î± â‹†' (refl r) â‰¡ Î± âˆ™áµ£ r 
  â‹†'-refl-is-âˆ™áµ£ (refl (refl .x)) (refl x) = refl _


