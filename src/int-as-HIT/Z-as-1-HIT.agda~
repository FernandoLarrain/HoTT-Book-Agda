{-# OPTIONS --without-K --exact-split --safe #-}

open import Ch1.Type-theory
open import Ch2.Homotopy-type-theory
open import Ch3.Sets-and-logic
open import Ch4.Equivalences
open import Ch5.8-Id-types-and-id-systems

module int-as-HIT.Z-as-1-HIT where

-- â„¤-algebras and their homomorphisms

Eqv : (ğ“¤ : Universe) â†’ ğ“¤ âº Ì‡
Eqv ğ“¤ = Î£ Aâ‚ ê‰ (ğ“¤ Ì‡) , Î£ Aâ‚‚ ê‰ (ğ“¤ Ì‡) , Aâ‚ â‰ƒ Aâ‚‚ -- It suffices to consider types in a single universe.


module EqvPreservation {Aâ‚ Aâ‚‚ : ğ“¤ Ì‡} {Bâ‚ Bâ‚‚ : ğ“¥ Ì‡} (fâ‚ : Aâ‚ â†’ Bâ‚) (fâ‚‚ : Aâ‚‚ â†’ Bâ‚‚) where

  module maps where

  s-pres : (Aâ‚ â†’ Aâ‚‚) â†’ (Bâ‚ â†’ Bâ‚‚) â†’ ğ“¤ âŠ” ğ“¥ Ì‡
  s-pres s s' = fâ‚‚ âˆ˜ s âˆ¼ s' âˆ˜ fâ‚

  p-pres : (Aâ‚‚ â†’ Aâ‚) â†’ (Bâ‚‚ â†’ Bâ‚) â†’ ğ“¤ âŠ” ğ“¥ Ì‡
  p-pres p p' = fâ‚ âˆ˜ p âˆ¼ p' âˆ˜ fâ‚‚

  open maps public

  module htpies (s : Aâ‚ â†’ Aâ‚‚) (p : Aâ‚‚ â†’ Aâ‚) (s' : Bâ‚ â†’ Bâ‚‚) (p' : Bâ‚‚ â†’ Bâ‚) (Î± : s-pres s s') (Î² : p-pres p p') where

    aux-Î³ : fâ‚ âˆ˜ p âˆ˜ s âˆ¼ p' âˆ˜ s' âˆ˜ fâ‚
    aux-Î³ aâ‚ = Î² (s aâ‚) âˆ™ ap p' (Î± aâ‚)

    Ïƒ-pres : (p âˆ˜ s âˆ¼ id) â†’ (p' âˆ˜ s' âˆ¼ id) â†’ ğ“¤ âŠ” ğ“¥ Ì‡
    Ïƒ-pres Ïƒ Ïƒ' = (aâ‚ : Aâ‚) â†’ ap fâ‚ (Ïƒ aâ‚) â‰¡ aux-Î³ aâ‚ âˆ™ Ïƒ' (fâ‚ aâ‚)

    aux-Î´ : fâ‚‚ âˆ˜ s âˆ˜ p âˆ¼ s' âˆ˜ p' âˆ˜ fâ‚‚
    aux-Î´ aâ‚‚ = Î± (p aâ‚‚) âˆ™ ap s' (Î² aâ‚‚)

    Ï-pres : (s âˆ˜ p âˆ¼ id) â†’ (s' âˆ˜ p' âˆ¼ id) â†’ ğ“¤ âŠ” ğ“¥ Ì‡
    Ï-pres Ï Ï' = (aâ‚‚ : Aâ‚‚) â†’ ap fâ‚‚ (Ï aâ‚‚) â‰¡ aux-Î´ aâ‚‚ âˆ™ Ï' (fâ‚‚ aâ‚‚)

    -- Preservation of coherence condition

    aux-Îµ-Î³â‚ : fâ‚‚ âˆ˜ s âˆ˜ p âˆ˜ s âˆ¼ s' âˆ˜ p' âˆ˜ s' âˆ˜ fâ‚
    aux-Îµ-Î³â‚ aâ‚ = Î± (p (s aâ‚)) âˆ™ ap s' (aux-Î³ aâ‚)

    aux-Îµ-Î´â‚ : fâ‚‚ âˆ˜ s âˆ˜ p âˆ˜ s âˆ¼ s' âˆ˜ p' âˆ˜ s' âˆ˜ fâ‚
    aux-Îµ-Î´â‚ aâ‚ = aux-Î´ (s aâ‚) âˆ™ ap s' (ap p' (Î± aâ‚))

    aux-Îµ-Î³â‚-is-aux-Îµ-Î´â‚ : aux-Îµ-Î³â‚ âˆ¼ aux-Îµ-Î´â‚
    aux-Îµ-Î³â‚-is-aux-Îµ-Î´â‚ aâ‚ = (refl (Î± (p (s aâ‚))) âœ¦ ap-âˆ™ s' _ _) âˆ™ âˆ™-assoc _ _ _

    aux-Îµ-Î³â‚‚ : (Ïƒ : p âˆ˜ s âˆ¼ id) (Ïƒ' : p' âˆ˜ s' âˆ¼ id) â†’ ((aâ‚ : Aâ‚) â†’ ap fâ‚ (Ïƒ aâ‚) â‰¡ aux-Î³ aâ‚ âˆ™ Ïƒ' (fâ‚ aâ‚)) â†’ (aâ‚ : Aâ‚) â†’ ap fâ‚‚ (ap s (Ïƒ aâ‚)) âˆ™ Î± aâ‚ â‰¡ aux-Îµ-Î³â‚ aâ‚ âˆ™ ap s' (Ïƒ' (fâ‚ aâ‚))
    aux-Îµ-Î³â‚‚ Ïƒ Ïƒ' Î³ aâ‚ = (ap-âˆ˜ s fâ‚‚ (Ïƒ aâ‚) âœ¦ refl (Î± aâ‚)) âˆ™ hnat Î± (Ïƒ aâ‚) â»Â¹ âˆ™ (refl (Î± (p (s aâ‚))) âœ¦ (ap-âˆ˜ fâ‚ s' (Ïƒ aâ‚) â»Â¹ âˆ™ ap (ap s') (Î³ aâ‚) âˆ™ ap-âˆ™ s' _ _)) âˆ™ âˆ™-assoc _ _ _

    aux-Îµ-Î´â‚‚ : (Ï : s âˆ˜ p âˆ¼ id) (Ï' : s' âˆ˜ p' âˆ¼ id) â†’ ((aâ‚‚ : Aâ‚‚) â†’ ap fâ‚‚ (Ï aâ‚‚) â‰¡ aux-Î´ aâ‚‚ âˆ™ Ï' (fâ‚‚ aâ‚‚)) â†’ (aâ‚ : Aâ‚) â†’ ap fâ‚‚ (Ï (s aâ‚)) âˆ™ Î± aâ‚ â‰¡ aux-Îµ-Î´â‚ aâ‚ âˆ™ Ï' (s' (fâ‚ aâ‚))
    aux-Îµ-Î´â‚‚ Ï Ï' Î´ aâ‚ = (Î´ (s aâ‚) âœ¦ ap-id (Î± aâ‚) â»Â¹) âˆ™ âˆ™-assoc _ _ _ â»Â¹ âˆ™ (refl (aux-Î´ (s aâ‚)) âœ¦ (hnat Ï' (Î± aâ‚) âˆ™ (ap-âˆ˜ p' s' (Î± aâ‚) â»Â¹ âœ¦ refl (Ï' (s' (fâ‚ aâ‚)))))) âˆ™ âˆ™-assoc _ _ _  

    module coh (Ïƒ : p âˆ˜ s âˆ¼ id) (Ï : s âˆ˜ p âˆ¼ id) (Ï„ : (aâ‚ : Aâ‚) â†’ ap s (Ïƒ aâ‚) â‰¡ Ï (s aâ‚)) (Ïƒ' : p' âˆ˜ s' âˆ¼ id) (Ï' : s' âˆ˜ p' âˆ¼ id) (Ï„' : (bâ‚ : Bâ‚) â†’ ap s' (Ïƒ' bâ‚) â‰¡ Ï' (s' bâ‚)) (Î³ : Ïƒ-pres Ïƒ Ïƒ') (Î´ : Ï-pres Ï Ï') where

      Ï„-pres : ğ“¤ âŠ” ğ“¥ Ì‡
      Ï„-pres = (aâ‚ : Aâ‚) â†’ (ap (ap fâ‚‚) (Ï„ aâ‚) âœ¦ refl (Î± aâ‚)) âˆ™ aux-Îµ-Î´â‚‚ Ï Ï' Î´ aâ‚ â‰¡ aux-Îµ-Î³â‚‚ Ïƒ Ïƒ' Î³ aâ‚ âˆ™ (aux-Îµ-Î³â‚-is-aux-Îµ-Î´â‚ aâ‚ âœ¦ Ï„' (fâ‚ aâ‚))

    open coh public

hae-pres : (A : Eqv ğ“¤) (B : Eqv ğ“¥) â†’ (prâ‚ A â†’ prâ‚ B) â†’ (prâ‚ (prâ‚‚ A) â†’ prâ‚ (prâ‚‚ B)) â†’ ğ“¤ âŠ” ğ“¥ Ì‡
hae-pres (Aâ‚ , Aâ‚‚ , s , p , Ïƒ , Ï , Ï„) (Bâ‚ , Bâ‚‚ , s' , p' , Ïƒ' , Ï' , Ï„') fâ‚ fâ‚‚ =
  Î£ Î± ê‰ s-pres s s' ,
  Î£ Î² ê‰ p-pres p p' ,
  Î£ Î³ ê‰ Ïƒ-pres Î± Î² Ïƒ Ïƒ' ,
  Î£ Î´ ê‰ Ï-pres Î± Î² Ï Ï' ,
  Ï„-pres Î± Î² Ïƒ Ï Ï„ Ïƒ' Ï' Ï„' Î³ Î´
  where open EqvPreservation fâ‚ fâ‚‚
        open htpies s p s' p'
      


EqvHom : Eqv ğ“¤ â†’ Eqv ğ“¥ â†’ ğ“¤ âŠ” ğ“¥ Ì‡
EqvHom A B = Î£ fâ‚ ê‰ (prâ‚ A â†’ prâ‚ B) , Î£ fâ‚‚ ê‰ (prâ‚ (prâ‚‚ A) â†’ prâ‚ (prâ‚‚ B)) , hae-pres A B fâ‚ fâ‚‚ 


â„¤Alg : (ğ“¤ : Universe) â†’ ğ“¤ âº Ì‡
â„¤Alg ğ“¤ = Î£ A ê‰ (ğ“¤ Ì‡) ,
         Î£ aâ‚€ ê‰ A ,
         Î£ s ê‰ (A â†’ A) ,
         Î£ p ê‰ (A â†’ A) ,
         Î£ Ïƒ ê‰ (p âˆ˜ s âˆ¼ id) ,
         Î£ Ï ê‰ (s âˆ˜ p âˆ¼ id) ,
         ((a : A) â†’ ap s (Ïƒ a) â‰¡ Ï (s a))

_ : (ğ“¤ : Universe) â†’ â„¤Alg ğ“¤ â‰¡ (Î£ A ê‰ (ğ“¤ Ì‡) , Î£ aâ‚€ ê‰ A , A â‰ƒ A)
_ = Î» ğ“¤ â†’ refl _


â„¤Hom : â„¤Alg ğ“¤ â†’ â„¤Alg ğ“¥ â†’ ğ“¤ âŠ” ğ“¥ Ì‡
â„¤Hom (A , aâ‚€ , s) (B , bâ‚€ , s') = Î£ f ê‰ (A â†’ B) , Î£ pâ‚€ ê‰ (f aâ‚€ â‰¡ bâ‚€) , hae-pres (A , A , s) (B , B , s') f f


